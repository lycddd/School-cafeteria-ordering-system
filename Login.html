<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>登录</title>
	<link href="denglu.css" rel="stylesheet" type="text/css">
	<script>
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "http://127.0.0.1:5000/api/v1/session");
		xhr.withCredentials = true;
		xhr.send();
		xhr.onreadystatechange = function () {
			if (xhr.readyState == 4) {
				if (xhr.status < 300) {
					window.location.href = "./School_information.html";
				}
			};
		}
	</script>
</head>

<body>
	<div class="div">
		<h2>食堂订菜系统</h2>
		<form method="POST" action="#" class="form">
			账号：&emsp;&emsp;<input type="text" id="name" />
			<br /> <br />
			密码：&emsp;&emsp;<input tbuype="password" id="password" />
			<br /> <br />
			<button href="#" >忘记密码</button>
			<button href="Register.html" >注册新账户</button>
			<button onclick="login()" >登录</button>
	</div>
	<script>
		function login() {
			const name = document.getElementById("name").value;
			const password = document.getElementById("password").value;
			var json_data = window.JSON.stringify({ "userName": name, "userPassword": password });
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "http://127.0.0.1:5000/api/v1/session");
			xhr.withCredentials = true;
			xhr.setRequestHeader("Content-type", "application/json");
			xhr.send(json_data);
			xhr.onreadystatechange = function () {
				if (xhr.readyState == 4) {
					if (xhr.status < 300) {
						window.location.href = "./School_information.html";
					} else {
						var response_data = JSON.parse(xhr.response)
						alert(response_data["error"]);
					}
				}
			};
		}
	</script>
</body>

</html>